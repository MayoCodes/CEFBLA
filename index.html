<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FBLA fitzone</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Bebas Neue', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #0a0a0a;
            color: #ffffff;
            overflow-x: hidden;
        }

        /* Navbar */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(10, 10, 10, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        nav.scrolled {
            background: rgba(10, 10, 10, 0.95);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .nav-logo-img {
            width: 45px;
            height: 45px;
            object-fit: contain;
        }

        .nav-logo-text {
            font-size: 1.5rem;
            font-weight: 900;
            letter-spacing: 3px;
            color: #ffffff;
        }

        .nav-logo-text span {
            color: #e63946;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: #aaa;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: color 0.3s ease;
            position: relative;
        }

        .nav-links a:hover {
            color: #ffffff;
        }



        /* Countdown Section - Positioned under Navbar */
        .countdown-section {
            position: fixed;
            top: 85px;
            left: 0;
            right: 0;
            z-index: 999;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem 2rem;
            transition: all 0.3s ease;
        }

        .countdown-section.scrolled {
            padding: 1rem 2rem;
        }

        .countdown-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 1rem;
        }

        .countdown-title {
            font-size: 1rem;
            color: #ffffff;
            font-weight: 700;
            letter-spacing: -0.5px;
            white-space: nowrap;
        }

        .countdown {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .countdown-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 70px;
        }
        
        .countdown-item:nth-child(2) {
        }
        
        .countdown-item:nth-child(3) {
        }
        
        .countdown-item:nth-child(4) {
        }

        .countdown-value {
            font-size: 2rem;
            font-weight: 800;
            color: #e63946;
            display: block;
            margin-bottom: 0.25rem;
        }

        .countdown-label {
            font-size: 0.7rem;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        /* Parallax Container */
        .parallax-container {
            position: relative;
            overflow: hidden;
        }

        /* Hero Section with Parallax */
        .hero {
            height: 100vh;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 155px;
        }

        .hero-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.7)),
                url('https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=1600&q=80') center/cover;
            transform: translateZ(0);
        }

        .hero-content {
            position: relative;
            z-index: 2;
            text-align: center;
            animation: fadeInUp 1s ease-out;
        }

        .hero h1 {
            font-size: 5rem;
            font-weight: 900;
            letter-spacing: 15px;
            margin-bottom: 1rem;
            color: #ffffff;
            text-shadow: 3px 3px 25px rgba(0, 0, 0, 0.9);
        }

        .hero .subtitle {
            font-size: 1.3rem;
            color: #cccccc;
            margin-bottom: 2rem;
            font-weight: 500;
            letter-spacing: 8px;
        }

        /* Section Title */
        .section-title {
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 3rem;
            font-weight: 800;
            letter-spacing: 8px;
        }

        /* Auth Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-overlay.active {
            display: flex;
        }

        .auth-modal {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 3rem;
            width: 90%;
            max-width: 450px;
            position: relative;
            animation: fadeInUp 0.4s ease-out;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: none;
            border: none;
            color: #999;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        .modal-close:hover {
            color: #ffffff;
            background: rgba(255, 255, 255, 0.1);
        }

        .auth-modal h2 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #ffffff;
            font-weight: 800;
            letter-spacing: -1px;
        }

        .auth-modal p {
            color: #999;
            margin-bottom: 2rem;
            font-size: 0.95rem;
        }

        .auth-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .auth-tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            color: #999;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
            font-family: 'Bebas Neue', sans-serif;
        }

        .auth-tab.active {
            color: #e63946;
            border-bottom-color: #e63946;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #ddd;
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input {
            width: 100%;
            padding: 0.875rem 1rem;
            background: rgba(15, 15, 15, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: #ffffff;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: 'Bebas Neue', sans-serif;
        }

        .form-group select {
            width: 100%;
            padding: 0.875rem 1rem;
            background: rgba(15, 15, 15, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            color: #ffffff;
            font-size: 1rem;
            font-family: 'Bebas Neue', sans-serif;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L6 6L11 1' stroke='%23e63946' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            padding-right: 3rem;
        }

        .form-group select:hover {
            border-color: #e63946;
        }

        .form-group select:focus {
            outline: none;
            border-color: #e63946;
            box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.2);
        }

        .form-group input:focus {
            outline: none;
            border-color: #e63946;
            box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.2);
        }

        .exercise-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .auth-btn {
            width: 100%;
            padding: 1rem;
            background: #e63946;
            border: none;
            border-radius: 4px;
            color: #ffffff;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Bebas Neue', sans-serif;
            margin-top: 0.5rem;
        }

        .auth-btn:hover {
            background: #d62839;
            transform: translateY(-2px) rotate(0deg);
            box-shadow: 0 8px 25px rgba(230, 57, 70, 0.3);
        }

        .auth-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .auth-divider {
            display: flex;
            align-items: center;
            margin: 2rem 0;
            color: #666;
            font-size: 0.875rem;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
        }

        .auth-divider span {
            padding: 0 1rem;
        }

        .google-btn {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: #ffffff;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Bebas Neue', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .google-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .error-message {
            display: none;
            padding: 0.875rem;
            background: rgba(230, 57, 70, 0.1);
            border: 1px solid rgba(230, 57, 70, 0.3);
            border-radius: 8px;
            color: #e63946;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }

        .error-message.show {
            display: block;
        }

        /* Dashboard Modal */
        /* Dashboard Modal */
        .dashboard-modal {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 3rem;
            width: 90%;
            max-width: 1200px;
            position: relative;
            animation: fadeInUp 0.4s ease-out;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .dashboard-header h2 {
            font-size: 2rem;
            color: #ffffff;
            font-weight: 800;
            letter-spacing: -1px;
            margin: 0;
        }

        .logout-btn {
            padding: 0.5rem 1rem;
            background: rgba(230, 57, 70, 0.1);
            border: 1px solid rgba(230, 57, 70, 0.3);
            border-radius: 8px;
            color: #e63946;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Bebas Neue', sans-serif;
        }

        .logout-btn:hover {
            background: rgba(230, 57, 70, 0.2);
            border-color: #e63946;
        }

        .user-stats {
            background: rgba(15, 15, 15, 0.8);
            border-radius: 6px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 2px solid rgba(255, 255, 255, 0.15);
        }

        .user-stats h3 {
            font-size: 0.875rem;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-item .label {
            font-size: 0.75rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .stat-item .value {
            font-size: 1.5rem;
            font-weight: 800;
            color: #e63946;
        }

        .achievement-section {
            margin-bottom: 2rem;
        }

        .achievement-section h3 {
            font-size: 1.25rem;
            color: #ffffff;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }

        .current-achievements {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .achievement-card {
            background: rgba(15, 15, 15, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 6px;
            padding: 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .achievement-card:nth-child(2) {
        }
        
        .achievement-card:nth-child(3) {
        }

        .achievement-card .exercise-name {
            font-size: 0.875rem;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .achievement-card .exercise-stats {
            font-size: 1.25rem;
            color: #ffffff;
            font-weight: 700;
        }

        .achievement-card .volume {
            font-size: 1rem;
            color: #e63946;
            font-weight: 700;
        }

        .success-message-dashboard {
            display: none;
            padding: 0.875rem;
            background: rgba(68, 255, 68, 0.1);
            border: 1px solid rgba(68, 255, 68, 0.3);
            border-radius: 8px;
            color: #44ff44;
            margin-bottom: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .success-message-dashboard.show {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        /* Camera Counter Styles */
        .logging-methods {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 1rem;
        }

        .method-tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            color: #999;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 2px;
        }

        .method-tab.active {
            color: #e63946;
            border-bottom-color: #e63946;
            transform: scale(1.05);
        }

        .logging-content {
            display: none;
        }

        .logging-content.active {
            display: block;
        }

        .split-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .camera-section {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .camera-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .camera-controls button {
            padding: 0.5rem 1rem;
            background: rgba(26, 26, 26, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: #999;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Bebas Neue', sans-serif;
        }

        .camera-controls button.active {
            background: #e63946;
            border-color: #e63946;
            color: #ffffff;
        }

        .camera-controls button:hover {
            border-color: #e63946;
            color: #ffffff;
        }

        #cameraStats {
            text-align: center;
            padding: 1rem;
            background: rgba(15, 15, 15, 0.8);
            border-radius: 4px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        #cameraStats .exercise-label {
            font-size: 0.875rem;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        #cameraStats .count-display {
            font-size: 3rem;
            font-weight: 800;
            color: #e63946;
        }

        #cameraVideoContainer {
            position: relative;
            width: 100%;
            aspect-ratio: 4/3;
            background: #000;
            border-radius: 6px;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.2);
        }

        #cameraWebcam {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }

        #cameraCanvas {
            position: absolute;
            width: 100%;
            height: 100%;
            transform: scaleX(-1);
        }

        #cameraDebugInfo {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 10;
            max-width: 200px;
        }

        #cameraStatus {
            text-align: center;
            color: #999;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .save-camera-btn {
            width: 100%;
            padding: 1rem;
            background: #e63946;
            border: 3px solid #d62839;
            border-radius: 4px;
            color: #ffffff;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Bebas Neue', sans-serif;
            margin-top: 1rem;
        }

        .save-camera-btn:hover {
            background: #d62839;
            transform: translateY(-2px) rotate(0deg);
            box-shadow: 0 8px 25px rgba(230, 57, 70, 0.3);
        }

        .save-camera-btn:disabled {
            background: #666;
            border-color: #555;
            cursor: not-allowed;
        }

        @media (max-width: 968px) {
            .split-view {
                grid-template-columns: 1fr;
            }
        }


        /* Leaderboard Section */
        .leaderboard-section {
            padding: 6rem 2rem;
            background: 
                linear-gradient(rgba(17, 17, 17, 0.95), rgba(17, 17, 17, 0.95)),
                url('https://images.unsplash.com/photo-1554284126-aa88f22d8b74?w=1600&q=80') center/cover fixed;
            position: relative;
        }

        .leaderboard-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .leaderboard-tabs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 0.875rem 1.75rem;
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 4px;
            color: #999;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Bebas Neue', sans-serif;
        }

        .tab-btn.active {
            background: #e63946;
            border-color: #e63946;
            color: #ffffff;
        }

        .tab-btn:hover {
            border-color: #e63946;
            color: #ffffff;
        }

        .leaderboard-table {
            width: 100%;
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 6px;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.15);
        }

        .leaderboard-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table thead {
            background: rgba(15, 15, 15, 0.9);
        }

        .leaderboard-table th {
            padding: 1.25rem 1.5rem;
            text-align: left;
            color: #e63946;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.8rem;
        }

        .leaderboard-table tbody tr {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s ease;
        }

        .leaderboard-table tbody tr:hover {
            background: rgba(230, 57, 70, 0.05);
        }

        .leaderboard-table td {
            padding: 1.25rem 1.5rem;
            color: #ccc;
            font-size: 0.95rem;
        }

        .rank {
            font-weight: 700;
            font-size: 1.1rem;
            color: #e63946;
        }

        .rank-1 { color: #FFD700; }
        .rank-2 { color: #C0C0C0; }
        .rank-3 { color: #CD7F32; }

        .total-weight {
            font-weight: 700;
            color: #ffffff;
            font-size: 1rem;
        }

        /* Stats Section */
        .stats-section {
            padding: 6rem 2rem;
            background: 
                linear-gradient(rgba(10, 10, 10, 0.95), rgba(10, 10, 10, 0.95)),
                url('https://images.unsplash.com/photo-1581009146145-b5ef050c2e1e?w=1600&q=80') center/cover fixed;
        }

        .stats-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .stat-card {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 6px;
            border: 2px solid rgba(255, 255, 255, 0.15);
        }
        
        .stat-card:nth-child(2) {
        }
        
        .stat-card:nth-child(3) {
        }

        .stat-card h3 {
            font-size: 0.875rem;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: #e63946;
            margin-bottom: 0.5rem;
        }

        .chart-container {
            height: 250px;
            margin-top: 1.5rem;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Scroll Animations */
        .scroll-animate {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s ease-out;
        }

        .scroll-animate.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Mobile Nav */
        .mobile-menu {
            display: none;
            cursor: pointer;
            flex-direction: column;
            gap: 5px;
        }

        .mobile-menu span {
            width: 25px;
            height: 3px;
            background: #fff;
            transition: all 0.3s ease;
        }

        /* Global Error Banner */
        .global-error-banner {
            display: none;
            position: fixed;
            top: 155px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            background: rgba(230, 57, 70, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 1rem 2rem;
            padding-right: 3rem;
            max-width: 90%;
            width: auto;
            box-shadow: 0 10px 40px rgba(230, 57, 70, 0.3);
            animation: slideDown 0.3s ease-out;
            position: relative;
        }

        .global-error-banner.show {
            display: block;
        }

        .global-error-banner p {
            color: #ffffff;
            font-weight: 600;
            margin: 0;
            font-size: 0.95rem;
            text-align: center;
        }

        .global-error-banner a {
            color: #ffffff;
            text-decoration: underline;
            font-weight: 700;
        }

        .banner-close {
            position: absolute;
            top: 50%;
            right: 0.75rem;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #ffffff;
            font-size: 1.5rem;
            cursor: pointer;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .banner-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        @media (max-width: 768px) {
            .nav-container {
                padding: 1.25rem 1.5rem;
            }

            .nav-logo-img {
                width: 38px;
                height: 38px;
            }

            .nav-logo-text {
                font-size: 1.25rem;
            }

            .nav-links {
                position: fixed;
                top: 85px;
                left: -100%;
                width: 100%;
                background: rgba(10, 10, 10, 0.98);
                backdrop-filter: blur(10px);
                flex-direction: column;
                padding: 2rem;
                transition: left 0.3s ease;
            }

            .nav-links.active {
                left: 0;
            }

            .mobile-menu {
                display: flex;
            }

            .countdown-section {
                padding: 1rem 1.5rem;
            }

            .countdown-container {
                gap: 0.75rem;
            }

            .countdown-title {
                font-size: 0.875rem;
            }

            .countdown {
                gap: 1rem;
            }

            .countdown-item {
                min-width: 60px;
            }

            .countdown-value {
                font-size: 1.5rem;
            }

            .hero {
                margin-top: 200px;
            }

            .hero h1 {
                font-size: 3rem;
            }

            .section-title {
                font-size: 2rem;
            }

            .achievement-form {
                padding: 2rem;
            }

            .leaderboard-table {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav id="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="fblaLogo.png" class="nav-logo-img">
                <div class="nav-logo-text">FIT<span>ZONE</span></div>
            </div>
            <ul class="nav-links" id="navLinks">
                <li><a href="#home">Home</a></li>
                <li><a href="#leaderboard">Leaderboard</a></li>
                <li><a href="#stats">Stats</a></li>
                <li><a href="#" id="authLink">Sign Up / Dashboard</a></li>
            </ul>
            <div class="mobile-menu" id="mobileMenu">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Countdown Section - Under Navbar -->
    <section class="countdown-section" id="countdown">
        <div class="countdown-container">
            <h2 class="countdown-title">Challenge Starts In</h2>
            <div class="countdown">
                <div class="countdown-item">
                    <span class="countdown-value" id="days">00</span>
                    <span class="countdown-label">Days</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-value" id="hours">00</span>
                    <span class="countdown-label">Hours</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-value" id="minutes">00</span>
                    <span class="countdown-label">Minutes</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-value" id="seconds">00</span>
                    <span class="countdown-label">Seconds</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Hero Section -->
    <section class="hero parallax-container" id="home">
        <div class="hero-background" id="heroBackground"></div>
        <div class="hero-content">
            <h1>FITZONE CHALLENGE</h1>
            <p class="subtitle">SQUAT • DEADLIFT • BENCH PRESS</p>
        </div>
    </section>

    <!-- Leaderboard Section -->
    <section class="leaderboard-section scroll-animate" id="leaderboard">
        <div class="leaderboard-container">
            <h2 class="section-title">Leaderboard</h2>
            
            <div class="leaderboard-tabs">
                <button class="tab-btn active" onclick="window.switchTab('squat')">Squat</button>
                <button class="tab-btn" onclick="window.switchTab('deadlift')">Deadlift</button>
                <button class="tab-btn" onclick="window.switchTab('benchpress')">Bench Press</button>
                <button class="tab-btn" onclick="window.switchTab('overall')">Overall</button>
            </div>

            <div class="leaderboard-table">
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Participant</th>
                            <th>Weight (lbs)</th>
                            <th>Sets</th>
                            <th>Reps</th>
                            <th>Total Volume</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <!-- Dynamic content will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Why Join Section -->
    <section class="leaderboard-section scroll-animate" style="background: linear-gradient(rgba(10, 10, 10, 0.9), rgba(10, 10, 10, 0.9)), url('https://images.unsplash.com/photo-1571902943202-507ec2618e8f?w=1600&q=80') center/cover fixed;">
        <div class="leaderboard-container" style="max-width: 900px;">
            <h2 class="section-title" style="text-align: left; margin-bottom: 2.5rem;">WHY JOIN</h2>
            <div style="display: flex; flex-direction: column; gap: 3rem;">
                <div style="display: flex; gap: 2rem; align-items: flex-start;">
                    <img src="https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=400&h=300&fit=crop&q=80" 
                         style="width: 220px; height: 160px; object-fit: cover; border: 3px solid rgba(230, 57, 70, 0.5);" alt="Gym">
                    <div>
                        <h3 style="font-size: 1.6rem; color: #e63946; margin-bottom: 1rem; letter-spacing: 2px;">TEST YOUR LIMITS</h3>
                        <p style="color: #bbb; line-height: 1.8; font-size: 1.05rem;">
                            Push beyond what you thought possible. Track every lift. See measurable progress. Compete against yourself and others.
                        </p>
                    </div>
                </div>

                <div style="display: flex; gap: 2rem; align-items: flex-start; flex-direction: row-reverse;">
                    <img src="https://images.unsplash.com/photo-1581009146145-b5ef050c2e1e?w=400&h=300&fit=crop&q=80" 
                         style="width: 220px; height: 160px; object-fit: cover; border: 3px solid rgba(247, 127, 0, 0.5);" alt="Powerlifting">
                    <div style="text-align: right;">
                        <h3 style="font-size: 1.6rem; color: #f77f00; margin-bottom: 1rem; letter-spacing: 2px;">REAL COMPETITION</h3>
                        <p style="color: #bbb; line-height: 1.8; font-size: 1.05rem;">
                            No fake numbers. No shortcuts. Just you, the barbell, and the truth. Live leaderboards update as lifts are logged.
                        </p>
                    </div>
                </div>

                <div style="display: flex; gap: 2rem; align-items: flex-start;">
                    <img src="https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=400&h=300&fit=crop&q=80" 
                         style="width: 220px; height: 160px; object-fit: cover; border: 3px solid rgba(6, 255, 165, 0.5);" alt="Training">
                    <div>
                        <h3 style="font-size: 1.6rem; color: #06ffa5; margin-bottom: 1rem; letter-spacing: 2px;">TRACK EVERYTHING</h3>
                        <p style="color: #bbb; line-height: 1.8; font-size: 1.05rem;">
                            AI-powered rep counting or manual logging. Your choice. Weight, sets, reps - all tracked automatically.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works Section -->
    <section class="stats-section scroll-animate" style="background: linear-gradient(rgba(17, 17, 17, 0.9), rgba(17, 17, 17, 0.9)), url('https://images.unsplash.com/photo-1554284126-aa88f22d8b74?w=1600&q=80') center/cover fixed;">
        <div class="stats-container" style="max-width: 1000px;">
            <h2 class="section-title" style="margin-bottom: 3rem;">THE PROCESS</h2>
            
            <div style="background: rgba(26, 26, 26, 0.7); padding: 3rem; border: 3px solid rgba(255, 255, 255, 0.15);">
                <div style="display: grid; grid-template-columns: 80px 1fr; gap: 2rem; align-items: start; margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 3.5rem; color: #e63946; font-weight: bold; line-height: 1;">01</div>
                    <div>
                        <h3 style="font-size: 1.4rem; color: #fff; margin-bottom: 0.75rem; letter-spacing: 2px;">SIGN UP</h3>
                        <p style="color: #999; line-height: 1.7;">Create your account. Takes 30 seconds. Email or Google. Thats it.</p>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 80px 1fr; gap: 2rem; align-items: start; margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 3.5rem; color: #f77f00; font-weight: bold; line-height: 1;">02</div>
                    <div>
                        <h3 style="font-size: 1.4rem; color: #fff; margin-bottom: 0.75rem; letter-spacing: 2px;">LIFT</h3>
                        <p style="color: #999; line-height: 1.7;">Squat, deadlift, bench press. Hit the weights. Push your limits.</p>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 80px 1fr; gap: 2rem; align-items: start; margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 3.5rem; color: #06ffa5; font-weight: bold; line-height: 1;">03</div>
                    <div>
                        <h3 style="font-size: 1.4rem; color: #fff; margin-bottom: 0.75rem; letter-spacing: 2px;">LOG IT</h3>
                        <p style="color: #999; line-height: 1.7;">Open dashboard. Log weight and reps. System calculates total volume.</p>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 80px 1fr; gap: 2rem; align-items: start;">
                    <div style="font-size: 3.5rem; color: #fff; font-weight: bold; line-height: 1;">04</div>
                    <div>
                        <h3 style="font-size: 1.4rem; color: #fff; margin-bottom: 0.75rem; letter-spacing: 2px;">COMPETE</h3>
                        <p style="color: #999; line-height: 1.7;">Check leaderboards. See where you rank. Beat your records.</p>
                    </div>
                </div>
            </div>

            <div style="text-align: center; padding: 2.5rem; background: rgba(230, 57, 70, 0.15); border: 2px dashed #e63946; margin-top: 2rem;">
                <p style="font-size: 1.4rem; color: #e63946; letter-spacing: 2px; line-height: 1.8;">
                    VOLUME = WEIGHT × SETS × REPS<br>
                    <span style="font-size: 0.9rem; color: #999;">HIGHEST TOTAL VOLUME WINS</span>
                </p>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section scroll-animate" id="stats">
        <div class="stats-container">
            <h2 class="section-title">Competition Statistics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Participants</h3>
                    <div class="stat-value" id="totalParticipants">0</div>
                    <div class="chart-container">
                        <canvas id="participationChart"></canvas>
                    </div>
                </div>
                <div class="stat-card">
                    <h3>Total Volume Lifted</h3>
                    <div class="stat-value" id="totalVolume">0</div>
                    <p style="color: #999; font-size: 0.875rem; margin-top: 0.5rem;">pounds across all exercises</p>
                </div>
                <div class="stat-card">
                    <h3>Exercise Distribution</h3>
                    <div class="chart-container">
                        <canvas id="exerciseChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Global Error Banner -->
    <div class="global-error-banner" id="globalErrorBanner">
        <p>WARNING: Connecting to Firestore...</p>
        <button class="banner-close" id="closeBanner">&times;</button>
    </div>

    <!-- Dashboard Modal -->
    <div class="modal-overlay" id="dashboardModal">
        <div class="dashboard-modal">
            <button class="modal-close" id="closeDashboard">&times;</button>
            
            <div class="dashboard-header">
                <h2>My Dashboard</h2>
                <button class="logout-btn" id="logoutBtn">Sign Out</button>
            </div>

            <div class="user-stats">
                <h3>Your Best Lifts</h3>
                <div class="stats-row">
                    <div class="stat-item">
                        <div class="label">Squat</div>
                        <div class="value" id="userSquat">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="label">Deadlift</div>
                        <div class="value" id="userDeadlift">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="label">Bench</div>
                        <div class="value" id="userBench">-</div>
                    </div>
                </div>
            </div>

            <div class="achievement-section">
                <h3>Log New Achievement</h3>
                
                <div class="logging-methods">
                    <button class="method-tab active" data-method="camera">AI Counter</button>
                    <button class="method-tab" data-method="manual">Manual Entry</button>
                </div>

                <div class="success-message-dashboard" id="successMessageDashboard">Achievement saved successfully!</div>

                <!-- Camera Counter Method -->
                <div class="logging-content active" id="cameraLogging">
                    <div class="split-view">
                        <!-- Left: Camera View -->
                        <div class="camera-section">
                            <div class="camera-controls">
                                <button id="cameraSquatBtn" class="active">Squat</button>
                                <button id="cameraBenchBtn">Bench Press</button>
                                <button id="cameraDeadliftBtn">Deadlift</button>
                                <button id="cameraResetBtn" style="margin-left: auto;">Reset</button>
                            </div>

                            <div id="cameraStats">
                                <div class="exercise-label" id="cameraExerciseLabel">SQUAT</div>
                                <div class="count-display" id="cameraCount">0</div>
                                <div style="font-size: 0.75rem; color: #666; margin-top: 0.5rem;">Reps Detected</div>
                            </div>

                            <div id="cameraVideoContainer">
                                <video id="cameraWebcam" autoplay playsinline></video>
                                <canvas id="cameraCanvas"></canvas>
                                <div id="cameraDebugInfo"></div>
                            </div>

                            <div id="cameraStatus">Loading AI model...</div>
                            
                            <div style="margin-top: 1rem; padding: 1rem; background: rgba(230, 57, 70, 0.1); border: 2px dashed rgba(230, 57, 70, 0.3); border-radius: 4px; text-align: center;">
                                <div style="font-size: 0.875rem; color: #e63946; font-weight: bold; margin-bottom: 0.5rem;">RAISE PALM TO ADD SET</div>
                                <div style="font-size: 0.75rem; color: #999;">Show palm like high-five to increment sets and reset reps</div>
                            </div>
                        </div>

                        <!-- Right: Save Form -->
                        <div class="camera-section">
                            <h4 style="font-size: 1.1rem; margin-bottom: 1rem; color: #fff;">Save Your Set</h4>
                            
                            <div class="form-group">
                                <label>Detected Reps (editable)</label>
                                <input type="number" id="cameraRepsInput" value="0" min="0"
                                       style="background: rgba(15, 15, 15, 0.8); border: 2px solid rgba(230, 57, 70, 0.3);">
                            </div>

                            <div class="form-group">
                                <label for="cameraWeight">Weight (lbs)</label>
                                <input type="number" id="cameraWeight" placeholder="0" min="0" step="0.5">
                            </div>

                            <div class="form-group">
                                <label for="cameraSets">Current Sets</label>
                                <input type="number" id="cameraSets" value="1" min="1" readonly
                                       style="background: rgba(15, 15, 15, 0.8); border: 2px solid rgba(255, 255, 255, 0.2);">
                            </div>

                            <button type="button" class="save-camera-btn" id="saveCameraAchievement">
                                Save Achievement
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Manual Entry Method -->
                <div class="logging-content" id="manualLogging">
                    <form id="dashboardAchievementForm">
                    <div class="form-group">
                        <label for="dashboardExercise">Exercise Type</label>
                        <select id="dashboardExercise" required>
                            <option value="">Select Exercise</option>
                            <option value="squat">Squat</option>
                            <option value="deadlift">Deadlift</option>
                            <option value="benchpress">Bench Press</option>
                        </select>
                    </div>

                    <div class="exercise-inputs">
                        <div class="form-group">
                            <label for="dashboardWeight">Weight (lbs)</label>
                            <input type="number" id="dashboardWeight" required placeholder="0" min="0" step="0.5">
                        </div>
                        <div class="form-group">
                            <label for="dashboardSets">Sets</label>
                            <input type="number" id="dashboardSets" required placeholder="0" min="1">
                        </div>
                        <div class="form-group">
                            <label for="dashboardReps">Reps</label>
                            <input type="number" id="dashboardReps" required placeholder="0" min="1">
                        </div>
                    </div>

                    <button type="submit" class="auth-btn">Save Achievement</button>
                </form>
                </div>
            </div>

            <div class="current-achievements">
                <h3 style="font-size: 1rem; color: #999; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 1rem;">Current Records</h3>
                <div class="achievement-card">
                    <div>
                        <div class="exercise-name">Squat</div>
                        <div class="exercise-stats" id="squatStats">Not logged</div>
                    </div>
                    <div class="volume" id="squatVolume">-</div>
                </div>
                <div class="achievement-card">
                    <div>
                        <div class="exercise-name">Deadlift</div>
                        <div class="exercise-stats" id="deadliftStats">Not logged</div>
                    </div>
                    <div class="volume" id="deadliftVolume">-</div>
                </div>
                <div class="achievement-card">
                    <div>
                        <div class="exercise-name">Bench Press</div>
                        <div class="exercise-stats" id="benchStats">Not logged</div>
                    </div>
                    <div class="volume" id="benchVolume">-</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal-overlay" id="authModal">
        <div class="auth-modal">
            <button class="modal-close" id="closeModal">&times;</button>
            <h2>Welcome to FitZone</h2>
            <p>Join the challenge and track your progress</p>

            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="signup">Sign Up</button>
                <button class="auth-tab" data-tab="login">Login</button>
            </div>

            <div class="error-message" id="errorMessage"></div>

            <!-- Sign Up Form -->
            <form class="auth-form active" id="signupForm">
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" required placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" required placeholder="Min. 6 characters">
                </div>
                <div class="form-group">
                    <label for="signupName">Display Name</label>
                    <input type="text" id="signupName" required placeholder="Your name">
                </div>
                <button type="submit" class="auth-btn">Create Account</button>
            </form>

            <!-- Login Form -->
            <form class="auth-form" id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required placeholder="Your password">
                </div>
                <button type="submit" class="auth-btn">Sign In</button>
            </form>

            <div class="auth-divider">
                <span>OR</span>
            </div>

            <button class="google-btn" id="googleSignIn">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z" fill="#4285F4"/>
                    <path d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z" fill="#34A853"/>
                    <path d="M3.964 10.71c-.18-.54-.282-1.117-.282-1.71 0-.593.102-1.17.282-1.71V4.958H.957C.347 6.173 0 7.548 0 9s.348 2.827.957 4.042l3.007-2.332z" fill="#FBBC05"/>
                    <path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z" fill="#EA4335"/>
                </svg>
                Continue with Google
            </button>
        </div>
    </div>

    <script type="module">
        // Import Firebase SDK v10+ (modular)
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword,
            signInWithPopup,
            GoogleAuthProvider,
            onAuthStateChanged,
            signOut,
            updateProfile
        } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { 
            getFirestore, 
            collection, 
            doc, 
            setDoc, 
            getDoc,
            getDocs,
            query,
            onSnapshot,
            serverTimestamp 
        } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        // Firebase configuration - REPLACE WITH YOUR CONFIG
        const firebaseConfig = {
        apiKey: "AIzaSyCkTEeWRXFH2N6Ttw0_ioP-cqImZFVbq5Q",
        authDomain: "fblatryouts.firebaseapp.com",
        projectId: "fblatryouts",
        storageBucket: "fblatryouts.firebasestorage.app",
        messagingSenderId: "337219854324",
        appId: "1:337219854324:web:799ebe988c8cf565a663a1"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // Global variable to track current user
        window.currentUser = null;

        // Auth state observer
        onAuthStateChanged(auth, (user) => {
            window.currentUser = user;
            updateAuthUI(user);
            if (user) {
                // Close auth modal if open
                document.getElementById('authModal').classList.remove('active');
                // Show dashboard modal
                loadUserDashboard(user);
            }
        });

        function updateAuthUI(user) {
            const authLink = document.getElementById('authLink');
            if (user) {
                authLink.textContent = 'Dashboard';
            } else {
                authLink.textContent = 'Sign Up / Dashboard';
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            setTimeout(() => errorDiv.classList.remove('show'), 5000);
        }

        // Load User Dashboard
        async function loadUserDashboard(user) {
            try {
                const userDocRef = doc(db, 'users', user.uid);
                const userDoc = await getDoc(userDocRef);

                if (userDoc.exists()) {
                    const data = userDoc.data();
                    const achievements = data.achievements || {};

                    // Update dashboard stats
                    document.getElementById('userSquat').textContent = achievements.squat ? `${achievements.squat.weight} lbs` : '-';
                    document.getElementById('userDeadlift').textContent = achievements.deadlift ? `${achievements.deadlift.weight} lbs` : '-';
                    document.getElementById('userBench').textContent = achievements.benchpress ? `${achievements.benchpress.weight} lbs` : '-';

                    // Update current records
                    updateRecordDisplay('squat', achievements.squat);
                    updateRecordDisplay('deadlift', achievements.deadlift);
                    updateRecordDisplay('benchpress', achievements.benchpress);
                } else {
                    // New user, set defaults
                    document.getElementById('userSquat').textContent = '-';
                    document.getElementById('userDeadlift').textContent = '-';
                    document.getElementById('userBench').textContent = '-';
                    updateRecordDisplay('squat', null);
                    updateRecordDisplay('deadlift', null);
                    updateRecordDisplay('benchpress', null);
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
                if (error.code === 'unavailable') {
                    // Show offline message
                    const errorDiv = document.getElementById('errorMessage');
                    errorDiv.textContent = 'Unable to load data. Please check your internet connection and make sure Firestore API is enabled.';
                    errorDiv.classList.add('show');
                    setTimeout(() => errorDiv.classList.remove('show'), 8000);
                }
            }
        }

        function updateRecordDisplay(exercise, achievement) {
            const statsId = exercise === 'benchpress' ? 'benchStats' : `${exercise}Stats`;
            const volumeId = exercise === 'benchpress' ? 'benchVolume' : `${exercise}Volume`;

            if (achievement) {
                document.getElementById(statsId).textContent = 
                    `${achievement.weight} lbs × ${achievement.sets} sets × ${achievement.reps} reps`;
                document.getElementById(volumeId).textContent = 
                    `${achievement.totalVolume.toLocaleString()} lbs total`;
            } else {
                document.getElementById(statsId).textContent = 'Not logged';
                document.getElementById(volumeId).textContent = '-';
            }
        }

        // Save Achievement to Firestore
        async function saveAchievement(user, exercise, weight, sets, reps) {
            const totalVolume = weight * sets * reps;
            const userDocRef = doc(db, 'users', user.uid);

            const achievementData = {
                weight: weight,
                sets: sets,
                reps: reps,
                totalVolume: totalVolume,
                timestamp: serverTimestamp()
            };

            // Get current user data
            const userDoc = await getDoc(userDocRef);
            
            if (userDoc.exists()) {
                const currentData = userDoc.data();
                const currentAchievements = currentData.achievements || {};
                
                // Only update if this is better than current record
                if (!currentAchievements[exercise] || totalVolume > currentAchievements[exercise].totalVolume) {
                    currentAchievements[exercise] = achievementData;
                    
                    await setDoc(userDocRef, {
                        displayName: user.displayName || user.email,
                        email: user.email,
                        achievements: currentAchievements
                    }, { merge: true });
                    
                    return true;
                } else {
                    return false; // Not a new record
                }
            } else {
                // First achievement for this user
                await setDoc(userDocRef, {
                    displayName: user.displayName || user.email,
                    email: user.email,
                    achievements: {
                        [exercise]: achievementData
                    }
                });
                return true;
            }
        }

        // Load Leaderboard from Firestore with Real-Time Updates
        function setupLeaderboardListeners() {
            const usersRef = collection(db, 'users');
            
            onSnapshot(usersRef, (snapshot) => {
                const allUsers = [];
                
                snapshot.forEach((doc) => {
                    const userData = doc.data();
                    if (userData.achievements) {
                        allUsers.push({
                            userId: doc.id,
                            displayName: userData.displayName,
                            achievements: userData.achievements
                        });
                    }
                });

                // Hide error banner if successful
                const banner = document.getElementById('globalErrorBanner');
                if (banner) {
                    banner.classList.remove('show');
                }

                // Update the global leaderboard display
                updateLeaderboardFromFirestore(allUsers);
                updateStatsFromFirestore(allUsers);
            }, (error) => {
                console.error('Firestore listener error:', error);
                
                // Show global error banner
                if (error.code === 'permission-denied' || error.code === 'unavailable') {
                    const banner = document.getElementById('globalErrorBanner');
                    if (banner) {
                        const projectId = firebaseConfig.projectId || 'your-project';
                        banner.innerHTML = `
                            <p>WARNING: Firestore API is not enabled. <a href="https://console.developers.google.com/apis/api/firestore.googleapis.com/overview?project=${projectId}" target="_blank">Click here to enable it</a> then refresh the page.</p>
                            <button class="banner-close" onclick="document.getElementById('globalErrorBanner').classList.remove('show')">&times;</button>
                        `;
                        banner.classList.add('show');
                    }
                }
            });
        }

        function updateLeaderboardFromFirestore(users) {
            // Store in window for tab switching
            window.firestoreUsers = users;
            
            // Update current active tab
            const activeTab = document.querySelector('.tab-btn.active');
            if (activeTab) {
                const exercise = activeTab.textContent.toLowerCase().replace(' ', '');
                displayLeaderboardForExercise(exercise, users);
            }
        }

        function displayLeaderboardForExercise(exercise, users) {
            const tbody = document.getElementById('leaderboardBody');
            let data = [];

            if (exercise === 'overall') {
                // Calculate overall scores
                users.forEach(user => {
                    let totalVolume = 0;
                    let totalWeight = 0;
                    let totalSets = 0;
                    let totalReps = 0;

                    ['squat', 'deadlift', 'benchpress'].forEach(ex => {
                        if (user.achievements[ex]) {
                            totalVolume += user.achievements[ex].totalVolume;
                            totalWeight += user.achievements[ex].weight;
                            totalSets += user.achievements[ex].sets;
                            totalReps += user.achievements[ex].reps;
                        }
                    });

                    if (totalVolume > 0) {
                        data.push({
                            name: user.displayName,
                            weight: totalWeight,
                            sets: totalSets,
                            reps: totalReps,
                            totalVolume: totalVolume
                        });
                    }
                });
            } else {
                // Single exercise leaderboard
                const exerciseKey = exercise === 'benchpress' ? 'benchpress' : exercise;
                
                users.forEach(user => {
                    if (user.achievements[exerciseKey]) {
                        const ach = user.achievements[exerciseKey];
                        data.push({
                            name: user.displayName,
                            weight: ach.weight,
                            sets: ach.sets,
                            reps: ach.reps,
                            totalVolume: ach.totalVolume
                        });
                    }
                });
            }

            // Sort by total volume
            data.sort((a, b) => b.totalVolume - a.totalVolume);

            // Generate table rows
            tbody.innerHTML = '';
            data.forEach((item, index) => {
                const row = document.createElement('tr');
                const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : 'rank';
                
                row.innerHTML = `
                    <td><span class="${rankClass}">${index + 1}</span></td>
                    <td>${item.name}</td>
                    <td>${item.weight} lbs</td>
                    <td>${item.sets}</td>
                    <td>${item.reps}</td>
                    <td class="total-weight">${item.totalVolume.toLocaleString()} lbs</td>
                `;
                tbody.appendChild(row);
            });

            // If no data, show placeholder
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #888888; padding: 3rem;">No achievements logged yet. Be the first!</td></tr>';
            }
        }

        // Make displayLeaderboardForExercise globally accessible
        window.displayLeaderboardForExercise = displayLeaderboardForExercise;

        function updateStatsFromFirestore(users) {
            // Calculate total participants
            const totalParticipants = users.length;
            document.getElementById('totalParticipants').textContent = totalParticipants;

            // Calculate total volume and exercise counts
            let totalVolume = 0;
            const exerciseCounts = { squat: 0, deadlift: 0, benchpress: 0 };
            const exerciseVolumes = { squat: 0, deadlift: 0, benchpress: 0 };

            users.forEach(user => {
                ['squat', 'deadlift', 'benchpress'].forEach(exercise => {
                    if (user.achievements[exercise]) {
                        totalVolume += user.achievements[exercise].totalVolume;
                        exerciseCounts[exercise]++;
                        exerciseVolumes[exercise] += user.achievements[exercise].totalVolume;
                    }
                });
            });

            document.getElementById('totalVolume').textContent = totalVolume.toLocaleString();

            // Update charts
            updateChartsFromData(exerciseCounts, exerciseVolumes);
        }

        function updateChartsFromData(exerciseCounts, exerciseVolumes) {
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.warn('Chart.js not loaded yet, skipping chart update');
                return;
            }

            try {
                // Participation chart
                const ctx1 = document.getElementById('participationChart');
                if (!ctx1) {
                    console.warn('participationChart canvas not found');
                    return;
                }

                if (window.participationChart && typeof window.participationChart.destroy === 'function') {
                    window.participationChart.destroy();
                }
                
                window.participationChart = new Chart(ctx1, {
                    type: 'bar',
                    data: {
                        labels: ['Squat', 'Deadlift', 'Bench Press'],
                        datasets: [{
                            label: 'Participants',
                            data: [exerciseCounts.squat, exerciseCounts.deadlift, exerciseCounts.benchpress],
                            backgroundColor: ['#e63946', '#f77f00', '#06ffa5'],
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { color: '#999' },
                                grid: { color: 'rgba(255,255,255,0.05)' }
                            },
                            x: {
                                ticks: { color: '#999' },
                                grid: { display: false }
                            }
                        }
                    }
                });

                // Exercise distribution chart
                const ctx2 = document.getElementById('exerciseChart');
                if (!ctx2) {
                    console.warn('exerciseChart canvas not found');
                    return;
                }

                if (window.exerciseChart && typeof window.exerciseChart.destroy === 'function') {
                    window.exerciseChart.destroy();
                }

                window.exerciseChart = new Chart(ctx2, {
                    type: 'doughnut',
                    data: {
                        labels: ['Squat', 'Deadlift', 'Bench Press'],
                        datasets: [{
                            data: [exerciseVolumes.squat, exerciseVolumes.deadlift, exerciseVolumes.benchpress],
                            backgroundColor: ['#e63946', '#f77f00', '#06ffa5'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: '#999', padding: 15 }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error updating charts:', error);
            }
        }

        // Modal controls
        const authModal = document.getElementById('authModal');
        const dashboardModal = document.getElementById('dashboardModal');
        const authLink = document.getElementById('authLink');
        const closeModal = document.getElementById('closeModal');
        const closeDashboard = document.getElementById('closeDashboard');
        const logoutBtn = document.getElementById('logoutBtn');

        authLink.addEventListener('click', (e) => {
            e.preventDefault();
            if (window.currentUser) {
                // User is logged in, show dashboard
                dashboardModal.classList.add('active');
                loadUserDashboard(window.currentUser);
                // Initialize camera after a short delay to allow modal to render
                setTimeout(() => {
                    if (window.initializeCamera) {
                        window.initializeCamera();
                    }
                }, 300);
            } else {
                // Show auth modal
                authModal.classList.add('active');
            }
        });

        closeModal.addEventListener('click', () => {
            authModal.classList.remove('active');
        });

        closeDashboard.addEventListener('click', () => {
            dashboardModal.classList.remove('active');
            // Stop camera stream
            if (window.stopCamera) {
                window.stopCamera();
            }
        });

        authModal.addEventListener('click', (e) => {
            if (e.target === authModal) {
                authModal.classList.remove('active');
            }
        });

        dashboardModal.addEventListener('click', (e) => {
            if (e.target === dashboardModal) {
                dashboardModal.classList.remove('active');
                // Stop camera stream
                if (window.stopCamera) {
                    window.stopCamera();
                }
            }
        });

        // Logout
        logoutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
                dashboardModal.classList.remove('active');
                alert('Signed out successfully!');
            } catch (error) {
                console.error('Sign out error:', error);
                alert('Failed to sign out: ' + error.message);
            }
        });

        // Dashboard Achievement Form
        document.getElementById('dashboardAchievementForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!window.currentUser) {
                alert('Please sign in to log achievements');
                return;
            }

            const exercise = document.getElementById('dashboardExercise').value;
            const weight = parseFloat(document.getElementById('dashboardWeight').value);
            const sets = parseInt(document.getElementById('dashboardSets').value);
            const reps = parseInt(document.getElementById('dashboardReps').value);
            const btn = e.target.querySelector('.auth-btn');

            btn.disabled = true;
            btn.textContent = 'Saving...';

            try {
                const isNewRecord = await saveAchievement(window.currentUser, exercise, weight, sets, reps);
                
                // Show success message
                const successMsg = document.getElementById('successMessageDashboard');
                if (isNewRecord) {
                    successMsg.textContent = 'New record saved successfully! ';
                } else {
                    successMsg.textContent = 'Achievement logged (not a new record)';
                }
                successMsg.classList.add('show');
                setTimeout(() => successMsg.classList.remove('show'), 3000);

                // Reset form
                e.target.reset();

                // Reload user dashboard
                await loadUserDashboard(window.currentUser);
            } catch (error) {
                console.error('Error saving achievement:', error);
                alert('Failed to save achievement: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Save Achievement';
            }
        });

        // Save Camera Achievement
        document.getElementById('saveCameraAchievement').addEventListener('click', async () => {
            if (!window.currentUser) {
                alert('Please sign in to log achievements');
                return;
            }

            const reps = parseInt(document.getElementById('cameraRepsInput').value);
            const weight = parseFloat(document.getElementById('cameraWeight').value);
            const sets = parseInt(document.getElementById('cameraSets').value);
            
            if (!weight || weight <= 0) {
                alert('Please enter the weight you lifted');
                return;
            }

            if (reps <= 0) {
                alert('No reps detected yet. Perform the exercise first!');
                return;
            }

            const btn = document.getElementById('saveCameraAchievement');
            btn.disabled = true;
            btn.textContent = 'Saving...';

            try {
                // Map camera exercise to database format
                const exerciseMap = {
                    'squat': 'squat',
                    'bench': 'benchpress',
                    'deadlift': 'deadlift'
                };
                
                const exercise = exerciseMap[window.cameraExerciseData.getCurrentExercise()];
                const isNewRecord = await saveAchievement(window.currentUser, exercise, weight, sets, reps);
                
                // Show success message
                const successMsg = document.getElementById('successMessageDashboard');
                if (isNewRecord) {
                    successMsg.textContent = 'New record saved successfully! ';
                } else {
                    successMsg.textContent = 'Achievement logged (not a new record)';
                }
                successMsg.classList.add('show');
                setTimeout(() => successMsg.classList.remove('show'), 3000);

                // Reset camera counter and form
                window.cameraExerciseData.reset();
                currentSets = 1;
                updateSetsDisplay();
                document.getElementById('cameraWeight').value = '';
                document.getElementById('cameraSets').value = '1';

                // Reload user dashboard
                await loadUserDashboard(window.currentUser);
            } catch (error) {
                console.error('Error saving camera achievement:', error);
                alert('Failed to save achievement: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Save Achievement';
            }
        });

        // Tab switching
        document.querySelectorAll('.auth-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.dataset.tab;
                
                // Update active tab
                document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                // Update active form
                document.querySelectorAll('.auth-form').forEach(form => {
                    form.classList.remove('active');
                });
                document.getElementById(`${tabName}Form`).classList.add('active');

                // Clear error
                document.getElementById('errorMessage').classList.remove('show');
            });
        });

        // Sign Up
        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const displayName = document.getElementById('signupName').value;
            const btn = e.target.querySelector('.auth-btn');

            btn.disabled = true;
            btn.textContent = 'Creating Account...';

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                await updateProfile(userCredential.user, { displayName: displayName });
                
                // Create user document in Firestore
                await setDoc(doc(db, 'users', userCredential.user.uid), {
                    displayName: displayName,
                    email: email,
                    achievements: {},
                    createdAt: serverTimestamp()
                });
                
                authModal.classList.remove('active');
                e.target.reset();
            } catch (error) {
                console.error('Sign up error:', error);
                let errorMessage = 'Failed to create account. ';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage += 'This email is already registered.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage += 'Invalid email address.';
                        break;
                    case 'auth/weak-password':
                        errorMessage += 'Password should be at least 6 characters.';
                        break;
                    default:
                        errorMessage += error.message;
                }
                
                showError(errorMessage);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Create Account';
            }
        });

        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const btn = e.target.querySelector('.auth-btn');

            btn.disabled = true;
            btn.textContent = 'Signing In...';

            try {
                await signInWithEmailAndPassword(auth, email, password);
                authModal.classList.remove('active');
                e.target.reset();
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Failed to sign in. ';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                    case 'auth/wrong-password':
                        errorMessage += 'Invalid email or password.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage += 'Invalid email address.';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage += 'Too many attempts. Please try again later.';
                        break;
                    default:
                        errorMessage += error.message;
                }
                
                showError(errorMessage);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Sign In';
            }
        });

        // Google Sign In
        document.getElementById('googleSignIn').addEventListener('click', async () => {
            const btn = document.getElementById('googleSignIn');
            btn.disabled = true;
            
            try {
                const result = await signInWithPopup(auth, googleProvider);
                
                // Check if user document exists, create if not
                const userDocRef = doc(db, 'users', result.user.uid);
                const userDoc = await getDoc(userDocRef);
                
                if (!userDoc.exists()) {
                    await setDoc(userDocRef, {
                        displayName: result.user.displayName || result.user.email,
                        email: result.user.email,
                        achievements: {},
                        createdAt: serverTimestamp()
                    });
                }
                
                authModal.classList.remove('active');
            } catch (error) {
                console.error('Google sign in error:', error);
                let errorMessage = 'Failed to sign in with Google. ';
                
                switch (error.code) {
                    case 'auth/popup-closed-by-user':
                        errorMessage += 'Sign in cancelled.';
                        break;
                    case 'auth/popup-blocked':
                        errorMessage += 'Please allow popups for this site.';
                        break;
                    default:
                        errorMessage += error.message;
                }
                
                showError(errorMessage);
            } finally {
                btn.disabled = false;
            }
        });

        // Make signOut available globally for potential logout button
        window.firebaseSignOut = async () => {
            try {
                await signOut(auth);
                alert('Signed out successfully!');
            } catch (error) {
                console.error('Sign out error:', error);
                alert('Failed to sign out: ' + error.message);
            }
        };

        // Initialize Firestore listeners after DOM and Chart.js are ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(() => setupLeaderboardListeners(), 100);
            });
        } else {
            // DOM already loaded
            setTimeout(() => setupLeaderboardListeners(), 100);
        }
    </script>

    <!-- MediaPipe Camera Counter -->
    <script type="module">
        import { PoseLandmarker, HandLandmarker, FilesetResolver } from 'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14';
        
        let poseLandmarker;
        let handLandmarker;
        let webcamRunning = false;
        let lastVideoTime = -1;
        
        let video = document.getElementById('cameraWebcam');
        let canvas = document.getElementById('cameraCanvas');
        let ctx;
        
        // Exercise tracking
        let currentCameraExercise = 'squat';
        let cameraCount = 0;
        let currentSets = 1;
        let isDown = false;
        let currentAngle = 0;
        let repDetected = false;
        let repDetectedTime = 0;
        let lastRepTime = 0;
        
        // Palm detection
        let palmRaised = false;
        let lastPalmTime = 0;
        const PALM_COOLDOWN = 2000; // 2 seconds between palm detections
        
        // Smoothing for stable detection
        let angleHistory = [];
        const SMOOTHING_WINDOW = 5;
        
        // Thresholds
        const SQUAT_KNEE_DOWN = 95;
        const SQUAT_KNEE_UP = 160;
        const BENCH_ELBOW_DOWN = 65;
        const BENCH_ELBOW_UP = 155;
        const DEADLIFT_WRIST_DOWN = 0.15;
        const DEADLIFT_WRIST_UP = 0.05;
        const REP_COOLDOWN = 1000;
        
        // Initialize when dashboard opens
        window.initializeCamera = async function() {
            if (webcamRunning) return; // Already running
            
            // Initialize canvas context
            if (!ctx) {
                ctx = canvas.getContext('2d');
                // Set canvas size based on container
                const container = document.getElementById('cameraVideoContainer');
                const rect = container.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = rect.height;
            }
            
            try {
                document.getElementById('cameraStatus').textContent = 'Loading AI model...';
                
                const vision = await FilesetResolver.forVisionTasks(
                    "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/wasm"
                );
                
                // Initialize pose landmarker
                poseLandmarker = await PoseLandmarker.createFromOptions(vision, {
                    baseOptions: {
                        modelAssetPath: "https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task",
                        delegate: "GPU"
                    },
                    runningMode: "VIDEO",
                    numPoses: 1
                });
                
                // Initialize hand landmarker for palm detection
                handLandmarker = await HandLandmarker.createFromOptions(vision, {
                    baseOptions: {
                        modelAssetPath: "https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task",
                        delegate: "GPU"
                    },
                    runningMode: "VIDEO",
                    numHands: 2
                });
                
                document.getElementById('cameraStatus').textContent = 'Starting camera...';
                
                const constraints = {
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    }
                };
                
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                
                video.addEventListener('loadeddata', () => {
                    webcamRunning = true;
                    document.getElementById('cameraStatus').textContent = 'Ready! Raise palm for new set.';
                    predictWebcam();
                });
            } catch (error) {
                console.error('Camera initialization error:', error);
                document.getElementById('cameraStatus').textContent = 'Error: ' + error.message;
            }
        };
        
        async function predictWebcam() {
            if (!webcamRunning) return;
            
            let startTimeMs = performance.now();
            if (lastVideoTime !== video.currentTime) {
                lastVideoTime = video.currentTime;
                
                try {
                    // Detect pose
                    const poseResults = await poseLandmarker.detectForVideo(video, startTimeMs);
                    
                    // Detect hands
                    const handResults = await handLandmarker.detectForVideo(video, startTimeMs);
                    
                    ctx.save();
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // Process pose
                    if (poseResults.landmarks && poseResults.landmarks.length > 0) {
                        const landmarks = poseResults.landmarks[0];
                        drawSkeleton(landmarks);
                        drawLandmarks(landmarks);
                        countExercise(landmarks);
                        drawDebug(landmarks);
                    }
                    
                    // Process hand for palm detection
                    if (handResults.landmarks && handResults.landmarks.length > 0) {
                        detectPalmGesture(handResults.landmarks);
                    }
                    
                    ctx.restore();
                } catch (error) {
                    console.error('Detection error:', error);
                }
            }
            
            if (repDetected && Date.now() - repDetectedTime > 500) {
                repDetected = false;
            }
            
            window.requestAnimationFrame(predictWebcam);
        }
        
        function detectPalmGesture(handsLandmarks) {
            // Check if enough time has passed since last palm detection
            if (Date.now() - lastPalmTime < PALM_COOLDOWN) return;
            
            for (const handLandmarks of handsLandmarks) {
                // Check if palm is raised (open hand)
                // Landmarks: 0=wrist, 4=thumb tip, 8=index tip, 12=middle tip, 16=ring tip, 20=pinky tip
                const wrist = handLandmarks[0];
                const thumbTip = handLandmarks[4];
                const indexTip = handLandmarks[8];
                const middleTip = handLandmarks[12];
                const ringTip = handLandmarks[16];
                const pinkyTip = handLandmarks[20];
                
                // Check if all fingertips are above wrist (raised hand)
                const fingersUp = 
                    indexTip.y < wrist.y &&
                    middleTip.y < wrist.y &&
                    ringTip.y < wrist.y &&
                    pinkyTip.y < wrist.y &&
                    thumbTip.y < wrist.y;
                
                if (fingersUp && !palmRaised) {
                    palmRaised = true;
                    lastPalmTime = Date.now();
                    
                    // Increment sets and reset reps
                    currentSets++;
                    cameraCount = 0;
                    updateCameraCount();
                    updateSetsDisplay();
                    
                    // Visual feedback
                    document.getElementById('cameraStatus').textContent = 'SET ' + currentSets + ' STARTED! Reps reset.';
                    setTimeout(() => {
                        document.getElementById('cameraStatus').textContent = 'Ready! Raise palm for new set.';
                    }, 2000);
                    
                    console.log('Palm detected! Set incremented to:', currentSets);
                } else if (!fingersUp) {
                    palmRaised = false;
                }
            }
        }
        
        function updateSetsDisplay() {
            document.getElementById('cameraSets').value = currentSets;
        }
        
        function drawLandmarks(landmarks) {
            for (let i = 0; i < landmarks.length; i++) {
                const landmark = landmarks[i];
                const x = landmark.x * canvas.width;
                const y = landmark.y * canvas.height;
                
                ctx.fillStyle = repDetected ? '#00FF00' : '#FFFF00';
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
                ctx.stroke();
            }
        }
        
        function drawSkeleton(landmarks) {
            const connections = [
                [11, 12], [11, 13], [13, 15], [12, 14], [14, 16],
                [11, 23], [12, 24], [23, 24], [23, 25], [25, 27],
                [24, 26], [26, 28]
            ];
            
            ctx.strokeStyle = repDetected ? '#00FF00' : '#00FFFF';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            
            for (const [start, end] of connections) {
                const startPoint = landmarks[start];
                const endPoint = landmarks[end];
                
                if (startPoint && endPoint) {
                    ctx.beginPath();
                    ctx.moveTo(startPoint.x * canvas.width, startPoint.y * canvas.height);
                    ctx.lineTo(endPoint.x * canvas.width, endPoint.y * canvas.height);
                    ctx.stroke();
                }
            }
        }
        
        function calculateAngle(a, b, c) {
            const radians = Math.atan2(c.y - b.y, c.x - b.x) - Math.atan2(a.y - b.y, a.x - b.x);
            let angle = Math.abs(radians * 180.0 / Math.PI);
            if (angle > 180.0) angle = 360 - angle;
            return angle;
        }
        
        function smoothAngle(newAngle) {
            angleHistory.push(newAngle);
            if (angleHistory.length > SMOOTHING_WINDOW) {
                angleHistory.shift();
            }
            const sum = angleHistory.reduce((a, b) => a + b, 0);
            return sum / angleHistory.length;
        }
        
        function countExercise(landmarks) {
            if (currentCameraExercise === 'squat') {
                countSquat(landmarks);
            } else if (currentCameraExercise === 'bench') {
                countBenchPress(landmarks);
            } else if (currentCameraExercise === 'deadlift') {
                countDeadlift(landmarks);
            }
        }
        
        function countSquat(landmarks) {
            if (Date.now() - lastRepTime < REP_COOLDOWN) return;
            
            const leftHip = landmarks[23];
            const leftKnee = landmarks[25];
            const leftAnkle = landmarks[27];
            const rightHip = landmarks[24];
            const rightKnee = landmarks[26];
            const rightAnkle = landmarks[28];
            
            if (!leftHip || !leftKnee || !leftAnkle || !rightHip || !rightKnee || !rightAnkle) return;
            
            const leftKneeAngle = calculateAngle(leftHip, leftKnee, leftAnkle);
            const rightKneeAngle = calculateAngle(rightHip, rightKnee, rightAnkle);
            const avgKneeAngle = (leftKneeAngle + rightKneeAngle) / 2;
            const smoothedAngle = smoothAngle(avgKneeAngle);
            currentAngle = smoothedAngle;
            
            if (smoothedAngle < SQUAT_KNEE_DOWN && !isDown) {
                isDown = true;
            } else if (smoothedAngle > SQUAT_KNEE_UP && isDown) {
                isDown = false;
                cameraCount++;
                updateCameraCount();
                repDetected = true;
                repDetectedTime = Date.now();
                lastRepTime = Date.now();
            }
        }
        
        function countBenchPress(landmarks) {
            if (Date.now() - lastRepTime < REP_COOLDOWN) return;
            
            const leftShoulder = landmarks[11];
            const leftElbow = landmarks[13];
            const leftWrist = landmarks[15];
            const rightShoulder = landmarks[12];
            const rightElbow = landmarks[14];
            const rightWrist = landmarks[16];
            
            if (!leftShoulder || !leftElbow || !leftWrist || !rightShoulder || !rightElbow || !rightWrist) return;
            
            const leftElbowAngle = calculateAngle(leftShoulder, leftElbow, leftWrist);
            const rightElbowAngle = calculateAngle(rightShoulder, rightElbow, rightWrist);
            const avgElbowAngle = (leftElbowAngle + rightElbowAngle) / 2;
            const smoothedAngle = smoothAngle(avgElbowAngle);
            currentAngle = smoothedAngle;
            
            if (smoothedAngle < BENCH_ELBOW_DOWN && !isDown) {
                isDown = true;
            } else if (smoothedAngle > BENCH_ELBOW_UP && isDown) {
                isDown = false;
                cameraCount++;
                updateCameraCount();
                repDetected = true;
                repDetectedTime = Date.now();
                lastRepTime = Date.now();
            }
        }
        
        function countDeadlift(landmarks) {
            if (Date.now() - lastRepTime < REP_COOLDOWN) return;
            
            const leftWrist = landmarks[15];
            const rightWrist = landmarks[16];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            
            if (!leftWrist || !rightWrist || !leftHip || !rightHip) return;
            
            const avgWristY = (leftWrist.y + rightWrist.y) / 2;
            const avgHipY = (leftHip.y + rightHip.y) / 2;
            const wristBelowHip = avgWristY - avgHipY;
            const smoothedDistance = smoothAngle(wristBelowHip * 100) / 100;
            currentAngle = smoothedDistance * 100;
            
            if (smoothedDistance > DEADLIFT_WRIST_DOWN && !isDown) {
                isDown = true;
            } else if (smoothedDistance < DEADLIFT_WRIST_UP && isDown) {
                isDown = false;
                cameraCount++;
                updateCameraCount();
                repDetected = true;
                repDetectedTime = Date.now();
                lastRepTime = Date.now();
            }
        }
        
        function updateCameraCount() {
            document.getElementById('cameraCount').textContent = cameraCount;
            document.getElementById('cameraRepsInput').value = cameraCount;
        }
        
        function drawDebug(landmarks) {
            const debugDiv = document.getElementById('cameraDebugInfo');
            let html = `
                <div style="color: white; font-size: 11px;">
                    <strong>Angle:</strong> ${currentAngle.toFixed(1)}°<br>
                    <strong>State:</strong> ${isDown ? 'DOWN' : 'UP'}<br>
                    <strong>Reps:</strong> ${cameraCount}
                </div>
            `;
            
            if (landmarks.length < 20) {
                html += '<div style="color: red; font-weight: bold; margin-top: 3px; font-size: 10px;">STEP BACK - NEED FULL BODY</div>';
            }
            
            debugDiv.innerHTML = html;
        }
        
        // Camera exercise buttons
        document.getElementById('cameraSquatBtn').addEventListener('click', () => {
            currentCameraExercise = 'squat';
            isDown = false;
            lastRepTime = 0;
            angleHistory = [];
            document.getElementById('cameraExerciseLabel').textContent = 'SQUAT';
            document.querySelectorAll('.camera-controls button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('cameraSquatBtn').classList.add('active');
        });
        
        document.getElementById('cameraBenchBtn').addEventListener('click', () => {
            currentCameraExercise = 'bench';
            isDown = false;
            lastRepTime = 0;
            angleHistory = [];
            document.getElementById('cameraExerciseLabel').textContent = 'BENCH PRESS';
            document.querySelectorAll('.camera-controls button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('cameraBenchBtn').classList.add('active');
        });
        
        document.getElementById('cameraDeadliftBtn').addEventListener('click', () => {
            currentCameraExercise = 'deadlift';
            isDown = false;
            lastRepTime = 0;
            angleHistory = [];
            document.getElementById('cameraExerciseLabel').textContent = 'DEADLIFT';
            document.querySelectorAll('.camera-controls button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('cameraDeadliftBtn').classList.add('active');
        });
        
        document.getElementById('cameraResetBtn').addEventListener('click', () => {
            cameraCount = 0;
            currentSets = 1;
            isDown = false;
            lastRepTime = 0;
            angleHistory = [];
            updateCameraCount();
            updateSetsDisplay();
        });
        
        // Tab switching
        document.querySelectorAll('.method-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const method = this.dataset.method;
                
                document.querySelectorAll('.method-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                document.querySelectorAll('.logging-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                if (method === 'camera') {
                    document.getElementById('cameraLogging').classList.add('active');
                    // Initialize camera when tab is opened
                    setTimeout(() => window.initializeCamera(), 100);
                } else {
                    document.getElementById('manualLogging').classList.add('active');
                }
            });
        });
        
        // Expose for global access
        window.cameraExerciseData = {
            getCurrentExercise: () => currentCameraExercise,
            getCount: () => cameraCount,
            reset: () => {
                cameraCount = 0;
                updateCameraCount();
            }
        };
        
        // Stop camera function
        window.stopCamera = function() {
            if (video && video.srcObject) {
                const stream = video.srcObject;
                const tracks = stream.getTracks();
                tracks.forEach(track => track.stop());
                video.srcObject = null;
                webcamRunning = false;
            }
        };
    </script>

    <script>
        // Close error banner
        const closeBannerBtn = document.getElementById('closeBanner');
        if (closeBannerBtn) {
            closeBannerBtn.addEventListener('click', () => {
                document.getElementById('globalErrorBanner').classList.remove('show');
            });
        }

        // Navbar scroll effect
        window.addEventListener('scroll', () => {
            const navbar = document.getElementById('navbar');
            const countdown = document.getElementById('countdown');
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
                countdown.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
                countdown.classList.remove('scrolled');
            }
        });

        // Mobile menu toggle
        document.getElementById('mobileMenu').addEventListener('click', () => {
            document.getElementById('navLinks').classList.toggle('active');
        });

        // Smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                const href = this.getAttribute('href');
                
                // Skip if href is just "#" (like auth link)
                if (href === '#' || href.length <= 1) {
                    return;
                }
                
                e.preventDefault();
                const target = document.querySelector(href);
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    document.getElementById('navLinks').classList.remove('active');
                }
            });
        });

        // Countdown Timer
        const countdownDate = new Date().getTime() + (7 * 24 * 60 * 60 * 1000); // 7 days from now

        function updateCountdown() {
            const now = new Date().getTime();
            const distance = countdownDate - now;

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById('days').textContent = String(days).padStart(2, '0');
            document.getElementById('hours').textContent = String(hours).padStart(2, '0');
            document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
            document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');

            if (distance < 0) {
                document.querySelector('.countdown-title').textContent = 'Challenge is Live!';
            }
        }

        setInterval(updateCountdown, 1000);
        updateCountdown();

        // Switch Tabs
        window.switchTab = function(exercise) {
            // Update active tab
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update leaderboard from Firestore data
            if (window.firestoreUsers && window.displayLeaderboardForExercise) {
                window.displayLeaderboardForExercise(exercise, window.firestoreUsers);
            }
        }

        // Parallax Effect
        window.addEventListener('scroll', () => {
            const scrolled = window.pageYOffset;
            const heroBackground = document.getElementById('heroBackground');
            
            if (heroBackground && scrolled < window.innerHeight) {
                heroBackground.style.transform = `translateY(${scrolled * 0.5}px)`;
            }
        });

        // Scroll Animations
        const observerOptions = {
            threshold: 0.15,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                }
            });
        }, observerOptions);

        document.querySelectorAll('.scroll-animate').forEach(el => {
            observer.observe(el);
        });
    </script>
</body>
</html>